# 数码管显示系统项目说明文档

## 项目概述

本项目是一个基于FPGA的数码管显示系统，能够将二进制计数器数值转换为BCD码，并通过4位数码管动态显示十进制数字。系统实现了从0到9999的自动循环计数显示功能。

## 项目文件结构

```
├── binary2bcd.v         # 二进制转BCD码转换模块（加3移位算法）
├── digi_tube_drv.v      # 数码管动态扫描驱动模块
├── digi_tube_top.v      # 顶层模块，集成计数器和显示功能
```

## 各模块功能说明

### 1. 二进制转BCD码转换模块 (binary2bcd.v)

**功能**：将14位二进制数（最大9999）转换为4位十进制BCD码。

**核心算法**：**加3移位法**（Double Dabble Algorithm）
- 一种高效的二进制转BCD算法
- 通过移位和条件加3操作实现转换
- 硬件实现简单，适合FPGA

**工作原理**：
1. 初始化四个4位寄存器：ones（个位）、tens（十位）、hundreds（百位）、thousands（千位）
2. 从最高位开始，依次处理二进制输入的每一位
3. 对每个BCD位：如果值≥5，则加3（为下一次左移做准备）
4. 左移整个BCD寄存器，移入当前二进制位
5. 重复直到所有位处理完毕

**接口**：
- 输入：`bin_in[13:0]` - 14位二进制数（最大9999）
- 输出：`bcd_out[15:0]` - 16位BCD码（每4位表示一个十进制位）

### 2. 数码管驱动模块 (digi_tube_drv.v)

**功能**：驱动4位共阳极数码管进行动态扫描显示。

**关键技术**：**动态扫描**
- 依次快速点亮每一位数码管
- 利用人眼视觉暂留效应，实现同时显示的效果
- 大幅减少引脚占用

**工作原理**：
1. **时钟分频**：将系统时钟分频到合适的扫描频率
   - 使用`div_cnt[13]`分频得到约3.57kHz扫描时钟
   - 每位显示时间约0.28ms，4位循环约1.12ms，刷新率约892Hz
   
2. **位选控制**：循环选中4位数码管
   - `bit_sel[3:0]`：低电平有效，依次为1110、1101、1011、0111
   - 实现4位循环扫描

3. **段选控制**：根据当前显示数字输出对应的段码
   - `seg_sel[7:0]`：共阳极段码（0-9的7段数码管编码）
   - 包含小数点控制

**接口**：
- 输入：四个4位BCD数字（d_0个位, d_1十位, d_2百位, d_3千位）
- 输出：`seg_sel[7:0]`（段选）、`bit_sel[3:0]`（位选）

### 3. 顶层模块 (digi_tube_top.v)

**功能**：集成计数器和显示功能，实现完整的数码管计数显示系统。

**系统架构**：
```
时钟 → 分频计数器 → 二进制计数器 → BCD转换 → 数码管驱动 → 数码管显示
```

**工作流程**：
1. **时钟分频**：将50MHz系统时钟分频到约23.84Hz
   - 使用`div_cnt[20]`作为计数器时钟
   - 每0.042秒计数器加1

2. **二进制计数**：0-9999循环计数
   - 每个div_clk上升沿计数器加1
   - 达到MAX_COUNT（默认9999）后归零

3. **BCD转换**：调用binary2bcd模块进行转换

4. **数码管显示**：调用digi_tube_drv模块驱动显示

**关键参数**：
- `MAX_COUNT`：最大计数值（默认9999）
- `CLK_FREQ`：系统时钟频率（默认50MHz）

## 技术原理详解

### 1. 动态扫描原理
```
时间轴：
时刻1：选中第0位，显示个位数，其他位关闭
时刻2：选中第1位，显示十位数，其他位关闭
时刻3：选中第2位，显示百位数，其他位关闭
时刻4：选中第3位，显示千位数，其他位关闭
时刻5：回到第0位，循环...
```
- 扫描频率足够高时（>60Hz），人眼看到的是4位数码管同时稳定显示
- 每位显示时间 = 1 / (扫描频率 × 位数)

### 2. 加3移位算法原理
以二进制数1101（十进制13）为例：
```
初始: 千位=0, 百位=0, 十位=0, 个位=0
处理第3位(1): 个位≥5?否 → 左移: 0001
处理第2位(1): 个位≥5?否 → 左移: 0011
处理第1位(0): 个位=3≥5?否 → 左移: 0110
处理第0位(1): 个位=6≥5?是 → 加3: 1001 → 左移: 0010(个位)+1=0011
结果: 千位=0, 百位=0, 十位=1, 个位=3 → 13
```

### 3. 时钟分频计算
系统时钟：50MHz（周期20ns）

1. **扫描时钟**（digi_tube_drv.v）：
   ```
   div_cnt[13]频率 = 50MHz / 2^(13+1)
                  = 50,000,000 / 16,384
                  ≈ 3,051.76Hz
   每位显示时间 = 1/3,051.76 ≈ 0.328ms
   4位循环时间 = 0.328ms × 4 ≈ 1.31ms
   刷新率 = 1/1.31ms ≈ 763Hz
   ```

2. **计数器时钟**（digi_tube_top.v）：
   ```
   div_cnt[20]频率 = 50MHz / 2^(20+1)
                  = 50,000,000 / 2,097,152
                  ≈ 23.84Hz
   计数间隔 = 1/23.84 ≈ 0.042秒
   计数到9999所需时间 = 9999 × 0.042 ≈ 420秒 ≈ 7分钟
   ```

## 硬件连接说明

### 数码管连接（共阳极）
```
seg_sel[7:0] → 数码管段选（a,b,c,d,e,f,g,dp）
bit_sel[3:0] → 数码管位选（位0-位3，低电平选中）

典型连接：
位3（千位）→ bit_sel[3]
位2（百位）→ bit_sel[2]
位1（十位）→ bit_sel[1]
位0（个位）→ bit_sel[0]
```

### 控制信号
- `clk`：50MHz系统时钟输入
- `rst_n`：复位信号（低电平有效）
- `seg_sel[7:0]`：段选信号输出
- `bit_sel[3:0]`：位选信号输出

## 使用与配置

### 1. 修改计数范围
在`digi_tube_top.v`中修改`MAX_COUNT`参数：
```verilog
parameter MAX_COUNT = 9999;  // 改为其他值如99、999等
```

### 2. 调整计数速度
修改分频系数改变计数速度：
```verilog
wire div_clk = div_cnt[20];  // 改为div_cnt[19]加快，div_cnt[21]减慢
```

### 3. 调整扫描频率
在`digi_tube_drv.v`中修改：
```verilog
wire div_clk = div_cnt[13];  // 改为其他位调整扫描频率
```

## 性能特点

### 优点
1. **资源高效**：使用动态扫描，大幅减少IO引脚占用
2. **算法高效**：加3移位算法硬件实现简单高效
3. **显示稳定**：高刷新率避免闪烁
4. **可扩展**：易于扩展到更多位数码管

### 技术指标
- **最大显示值**：9999
- **计数精度**：±1计数
- **显示刷新率**：约763Hz
- **计数速度**：约24次/秒
- **资源占用**：低（适合大多数FPGA）

## 应用场景

1. **计数器/计时器**：电子钟、秒表、计数器
2. **仪器仪表**：电压表、频率计显示
3. **工业控制**：生产线计数、设备状态显示
4. **教学演示**：FPGA数字系统设计实例
5. **嵌入式系统**：各种需要数字显示的应用

## 扩展建议

1. **增加按键控制**：复位、暂停、清零功能
2. **添加预置值**：可设置初始计数值
3. **方向控制**：支持递增/递减计数
4. **多模式显示**：十六进制、二进制显示模式
5. **通信接口**：添加UART/SPI接收显示数据
6. **亮度调节**：PWM调节数码管亮度

该项目展示了FPGA在数字显示和算法实现方面的典型应用，是一个完整的数字系统设计实例，适合学习FPGA开发、数字电路设计和Verilog编程。